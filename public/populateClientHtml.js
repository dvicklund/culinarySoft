$(document).ready(function() {
  // Single out products from product list by name
  $("#search").keyup(function(e){
    e.preventDefault();
    var search = $("#search").val();
    $.post("/client/products", {nameText: search}).done(function(data){
      displayList(data);
    });
  });
});

$('#myList').hide();

$('#myListLink').on('click', function() {
  $("#myList").slideDown('normal');
});

$('#closeListLink').on('click', function() {

  $("#myList").slideUp('fast')
});

// hide/show vendor list.
$('#vendorListForm').hide();

$('#vendorListLink').on('click', function() {
  $("#vendorListForm").slideDown('normal');
});

$('#saveNewVendor').on('click', function() {
  $("#vendorListForm").slideUp('fast')
});

$('#cancelVendorAdd').on('click', function(e) {
  e.preventDefault();
  $("#vendorListForm").slideUp('fast')
});

// hide/show item list.
$('#newProductForm').hide();

$('#showItemForm').on('click', function() {
  $("#newProductForm").slideDown('normal');
});

$('#saveInfo').on('click', function() {
  $("#newProductForm").slideUp('fast')
});

$('#cancel').on('click', function(e) {
  e.preventDefault();
  $("#newProductForm").slideUp('fast')
});

$.get("/client/product", function(data) {
  // Grab product list container tbody element
  $list = $("#listBody");

  // Initialize counter (for auto-UPN population) and htmlString (for table row population)
  var htmlString = '';

  // Loop through product data from DB and format
  data.forEach(function(curr) {
    htmlString += '<tr id="' + curr._id + '">';

    // Remove button generated by checking product's _id property
    htmlString += '<td><form action="/client/product/' + curr._id + '" method="POST"><input type="submit" value="Remove"></input></form></td>';

    // Loop through each product to fill <td>s
    for(var j = 1; j < Object.keys(curr).length - 1; j++) {
                                      // Here, using the 'numeral' library to format 2nd column as currency
      j === 2 ? htmlString += '<td>' + numeral(Number(curr[Object.keys(curr)[j]])).format('0') + ' /</td>'
              : htmlString += '<td>' + curr[Object.keys(curr)[j]] + '</td>';
    }
    htmlString += '</tr>';

  });

  // Fill the table with the new string
  $list.append(htmlString);
});

// Display search results function (sans button)
var displayResults = function(data) {
  $result = $('#searchResult');
  var htmlString = '';
  data.forEach(function(curr) {
    htmlString += '<tr id="' + curr._id + '">';
    for(var i = 1; i < Object.keys(curr).length - 1; i++) {
      i === 2 ? htmlString += '<td>' + numeral(Number(curr[Object.keys(curr)[i]])).format('0') + ' /</td>'
              : htmlString += '<td>' + curr[Object.keys(curr)[i]] + '</td>';
    }
    htmlString += '</tr>';
  });
  $result.html(htmlString);
};

var displayList = function(data) {
  $result = $('#listBody');
  var htmlString = '';
  data.forEach(function(curr) {
    htmlString += '<tr id="' + curr._id + '">';
    htmlString += '<td><form action="/client/product/' + curr._id + '" method="POST"><input type="submit" value="Remove"></input></form></td>';
    for(var i = 1; i < Object.keys(curr).length - 1; i++) {
      i === 2 ? htmlString += '<td>' + numeral(Number(curr[Object.keys(curr)[i]])) + ' /</td>'
              : htmlString += '<td>' + curr[Object.keys(curr)[i]] + '</td>';
    }
    htmlString += '</tr>';
  });
  $result.html(htmlString);
};
